/*
 * Copyright (c) 2014 Stephen Peasley (http://www.speasley.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * 
 * Version 2.0.0
 * Made in Canada
 */
!function(e){"use strict";var t={},n=t.renameKey=function(e,t,n){return t==n?e:(e.hasOwnProperty(t)&&(e[n]=e[t],delete e[t]),e)},a=t.mergeHashes=function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},r=t.specialDate=function(e,t){var n,a;return"_nthDay"==e.slice(0,7)&&(n=e.substring(7),n=n.slice(1,-1),a=f(n,t)),"_weekda"==e.slice(0,7)&&(n=e.substring(14),n=n.slice(1,-1),a=h(n,t)),a},u=t.timestamp=function(e,t,n){var a=new Date(n,e,t).getTime()/1e3;return a},s=t.globalYear=function(e){var t=(new Date).getFullYear(),n=null;return e>6&&(n=e.slice(-4),t=e),t},c=t.monthIndex=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sep","Oct","Nov","Dec"];return t.indexOf(e)},i=t.monthName=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sep","Oct","Nov","Dec"];return t[e]},o=t.weekdayIndex=function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t.indexOf(e)},l=(t.weekdayName=function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t[e]},t.todaysDate=function(e){var t=new Date;e&&e.length>5&&t.setFullYear(s(e.slice(-4)));var n=t.getMonth(),a=t.getDate(),r=i(n)+" "+(10>a?"0":"")+a;return e&&(r=e),r}),f=t.nthDay=function(e,t){var e=e.split(","),n=Number(e[0]),a=o(e[1]),r=c(e[2]),u=new Date,s=u.getFullYear();t&&t.length>6&&(s=t.slice(-4));var l=1,f=new Date(s,r,l),h=0;if(a!=f.getDay())for(var g=f.getDay();g!=a;)g++,h++,7==g&&(g=0);l=l+h+7*(n-1),f=f.setDate(l),f=new Date(f),r=f.getMonth();var v=i(r)+" "+(10>l?"0":"")+l;return v},h=t.weekdayBefore=function(e,t){var e=e.split(","),n=o(e[0]),a=c(e[1]),r=Number(e[2]),s=new Date,l=s.getFullYear();t&&t.length>6&&(l=t.slice(-4));var f,h=new Date(l,a,r);if(h.getDay()==n)f=u(a,r,l)-604800;else{for(var g=0,v=h.getDay();v!=n;)v--,g++,-1==v&&(v=6);f=u(a,r,l)-86400*g,f=new Date(1e3*f),a=i(f.getMonth()),r=f.getDate()<10?"0"+f.getDate():f.getDate();var y=a+" "+r}return y},g=t.sanitizePath=function(e){return"/"!=e.slice(-1)&&(e+="/"),e};e.fn.occasions=function(){var u=["occasions.json"],s=null,c=e.extend({internals:!1,path:"",onSuccess:function(){}},arguments[0]||{});if(c.internals)return t;c.country&&u.push(c.country.toLowerCase()+".json"),c.sect&&u.push(c.sect.toLowerCase()+".json"),""!=c.path&&(c.path=g(c.path));for(var i=0;i<u.length;i++)e.ajax({async:!1,url:c.path+u[i],type:"get",dataType:"json",success:function(e){null==s?s=e:a(s,e)}});Object.keys(s).forEach(function(e){s[e];"_"==e.slice(0,1)&&(s=n(s,e,r(e,c.date_override)))});var o=l(c.date_override).slice(0,6);return null!=s[o]&&(this.addClass(s[o]),this.data("occasion",s[o]),c.onSuccess.call(this)),this}}(jQuery);