/*
 * Copyright (c) 2014 Stephen Peasley (http://www.speasley.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * 
 * Version 2.1.1
 * Made in Canada
 */
!function(e){"use strict";var t={},n=t.renameKey=function(e,t,n){return t==n?e:(e.hasOwnProperty(t)&&(e[n]=e[t],delete e[t]),e)},a=t.mergeHashes=function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},r=t.specialDate=function(e,t){var n,a;return"_nthDay"==e.slice(0,7)&&(n=e.substring(7),n=n.slice(1,-1),a=g(n,t)),"_weekda"==e.slice(0,7)&&(n=e.substring(14),n=n.slice(1,-1),a=f(n,t)),"_lastWe"==e.slice(0,7)&&(n=e.substring(12),n=n.slice(1,-1),a=h(n,t)),a},s=t.timestamp=function(e,t,n){var a=new Date(n,e,t).getTime()/1e3;return a},u=t.globalYear=function(e){var t=(new Date).getFullYear(),n=null;return e>6&&(n=e.slice(-4),t=e),t},c=t.monthIndex=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t.indexOf(e)},i=t.monthName=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t[e]},o=t.weekdayIndex=function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t.indexOf(e)},l=(t.weekdayName=function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t[e]},t.todaysDate=function(e){var t=new Date;e&&e.length>5&&t.setFullYear(u(e.slice(-4)));var n=t.getMonth(),a=t.getDate(),r=i(n)+" "+(10>a?"0":"")+a;return e&&(r=e),r}),g=t.nthDay=function(e,t){var e=e.split(","),n=Number(e[0]),a=o(e[1]),r=c(e[2]),s=new Date,u=s.getFullYear();t&&t.length>6&&(u=t.slice(-4));var l=1,g=new Date(u,r,l),f=0;if(a!=g.getDay())for(var h=g.getDay();h!=a;)h++,f++,7==h&&(h=0);l=l+f+7*(n-1),g=g.setDate(l),g=new Date(g),r=g.getMonth();var D=i(r)+" "+(10>l?"0":"")+l;return D},f=t.weekdayBefore=function(e,t){var e=e.split(","),n=o(e[0]),a=c(e[1]),r=Number(e[2]),u=new Date,l=u.getFullYear();t&&t.length>6&&(l=t.slice(-4));var g,f=new Date(l,a,r);if(f.getDay()==n)g=s(a,r,l)-604800;else{for(var h=0,D=f.getDay();D!=n;)D--,h++,-1==D&&(D=6);g=s(a,r,l)-86400*h}return g=new Date(1e3*g),a=i(g.getMonth()),r=g.getDate()<10?"0"+g.getDate():g.getDate(),g=a+" "+r},h=t.lastWeekday=function(e,t){var e=e.split(","),n=o(e[0]),a=c(e[1]),r=new Date,u=r.getFullYear();t&&t.length>6&&(u=t.slice(-4));var i,l=new Date(u,a+1,0);if(l.getDay()==n)i=l;else{for(var g=0,f=l.getDay();f!=n;)f--,g++,-1==f&&(f=6);i=s(a+1,0,u)-86400*g,i=new Date(1e3*i);var h=i.getDate()<10?"0"+i.getDate():i.getDate();i=e[1]+" "+h}return i},D=t.getPath=function(){var e="jquery.occasions",t=document.getElementsByTagName("script"),n="";if(t&&t.length>0)for(var a in t)if(t[a].src&&t[a].src.match(new RegExp(e+"\\.js$")))return n=t[a].src.replace(new RegExp("(.*)"+e+"\\.js$"),"$1"),"file"==n.slice(0,4)&&"jquery.occasions/src/"==n.slice(-21)?"./":n},v=t.sanitizePath=function(e){return"/"!=e.slice(-1)&&(e+="/"),e};e.fn.occasions=function(){var s=["occasions.json"],u=null,c=e.extend({internals:!1,path:D(),onSuccess:function(){}},arguments[0]||{});if(c.internals)return t;c.country&&s.push(c.country.toLowerCase()+".json"),c.sect&&s.push(c.sect.toLowerCase()+".json"),c.path&&(c.path=v(c.path));for(var i=0;i<s.length;i++)e.ajax({async:!1,url:c.path+s[i],type:"get",dataType:"json",success:function(e){null==u?u=e:a(u,e)}});Object.keys(u).forEach(function(e){u[e];"_"==e.slice(0,1)&&(u=n(u,e,r(e,c.date_override)))});var o=l(c.date_override).slice(0,6);return null!=u[o]&&(this.addClass(u[o]),this.data("occasion",u[o]),c.onSuccess.call(this)),this}}(jQuery);