/*
 * Copyright (c) 2014 Stephen Peasley (http://www.speasley.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * 
 * Version 2.1.0
 * Made in Canada
 */
!function(e){"use strict";var t={},n=t.renameKey=function(e,t,n){return t==n?e:(e.hasOwnProperty(t)&&(e[n]=e[t],delete e[t]),e)},a=t.mergeHashes=function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},r=t.specialDate=function(e,t){var n,a;return"_nthDay"==e.slice(0,7)&&(n=e.substring(7),n=n.slice(1,-1),a=g(n,t)),"_weekda"==e.slice(0,7)&&(n=e.substring(14),n=n.slice(1,-1),a=f(n,t)),"_lastWe"==e.slice(0,7)&&(n=e.substring(12),n=n.slice(1,-1),a=D(n,t)),a},u=t.timestamp=function(e,t,n){var a=new Date(n,e,t).getTime()/1e3;return a},s=t.globalYear=function(e){var t=(new Date).getFullYear(),n=null;return e>6&&(n=e.slice(-4),t=e),t},i=t.monthIndex=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t.indexOf(e)},c=t.monthName=function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t[e]},o=t.weekdayIndex=function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t.indexOf(e)},l=(t.weekdayName=function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t[e]},t.todaysDate=function(e){var t=new Date;e&&e.length>5&&t.setFullYear(s(e.slice(-4)));var n=t.getMonth(),a=t.getDate(),r=c(n)+" "+(10>a?"0":"")+a;return e&&(r=e),r}),g=t.nthDay=function(e,t){var e=e.split(","),n=Number(e[0]),a=o(e[1]),r=i(e[2]),u=new Date,s=u.getFullYear();t&&t.length>6&&(s=t.slice(-4));var l=1,g=new Date(s,r,l),f=0;if(a!=g.getDay())for(var D=g.getDay();D!=a;)D++,f++,7==D&&(D=0);l=l+f+7*(n-1),g=g.setDate(l),g=new Date(g),r=g.getMonth();var h=c(r)+" "+(10>l?"0":"")+l;return h},f=t.weekdayBefore=function(e,t){var e=e.split(","),n=o(e[0]),a=i(e[1]),r=Number(e[2]),s=new Date,l=s.getFullYear();t&&t.length>6&&(l=t.slice(-4));var g,f=new Date(l,a,r);if(f.getDay()==n)g=u(a,r,l)-604800;else{for(var D=0,h=f.getDay();h!=n;)h--,D++,-1==h&&(h=6);g=u(a,r,l)-86400*D}return g=new Date(1e3*g),a=c(g.getMonth()),r=g.getDate()<10?"0"+g.getDate():g.getDate(),g=a+" "+r},D=t.lastWeekday=function(e,t){var e=e.split(","),n=o(e[0]),a=i(e[1]),r=new Date,s=r.getFullYear();t&&t.length>6&&(s=t.slice(-4));var c,l=new Date(s,a+1,0);if(l.getDay()==n)c=l;else{for(var g=0,f=l.getDay();f!=n;)f--,g++,-1==f&&(f=6);c=u(a+1,0,s)-86400*g,c=new Date(1e3*c);var D=c.getDate()<10?"0"+c.getDate():c.getDate();c=e[1]+" "+D}return c},h=t.sanitizePath=function(e){return"/"!=e.slice(-1)&&(e+="/"),e};e.fn.occasions=function(){var u=["occasions.json"],s=null,i=e.extend({internals:!1,path:"",onSuccess:function(){}},arguments[0]||{});if(i.internals)return t;i.country&&u.push(i.country.toLowerCase()+".json"),i.sect&&u.push(i.sect.toLowerCase()+".json"),""!=i.path&&(i.path=h(i.path));for(var c=0;c<u.length;c++)e.ajax({async:!1,url:i.path+u[c],type:"get",dataType:"json",success:function(e){null==s?s=e:a(s,e)}});Object.keys(s).forEach(function(e){s[e];"_"==e.slice(0,1)&&(s=n(s,e,r(e,i.date_override)))});var o=l(i.date_override).slice(0,6);return null!=s[o]&&(this.addClass(s[o]),this.data("occasion",s[o]),i.onSuccess.call(this)),this}}(jQuery);